name: 'test'
description: 'Run automated test cases'
inputs:
  tag:
    required: true
    description: 'Tag via which docker image will be selected'
  command:
    required: false
    description: 'Command to run against the docker image to run test cases. If not provided runs "npm test".'
    default: 'npm test'
runs:
  using: composite
  steps:
    - name: Download artifact
      uses: actions/download-artifact@v2
      with:
        name: myappartifact
        path: /tmp

    - name: Run tests
      shell: bash
      env:
        DOCKER_IMAGE: ${{ inputs.tag }}
        DOCKER_COMMAND: ${{ inputs.command }}
      run: |
        docker load --input /tmp/myappimage.tar
        source platform/src/scripts/kube/test.sh
